# Boot-Monitoring Installation Guide for RevPi

This guide explains how to install the Boot-Monitoring application on a new Revolution Pi (RevPi) device.

## Prerequisites

- Revolution Pi device with Raspbian/Debian OS
- Internet connection
- SSH access or direct terminal access
- User with sudo privileges (default: `pi`)

## Quick Installation

### Step 1: Transfer Files to RevPi

Choose one of these methods:

#### Option A: Using Git (Recommended)
```bash
cd /home/pi
git clone <your-repository-url> Boot-Monitoring
```

#### Option B: Using SCP from your computer
```bash
scp -r /path/to/Boot-Monitoring pi@<revpi-ip>:/home/pi/
```

#### Option C: Using USB Drive
1. Copy `Boot-Monitoring` folder to USB drive
2. Insert USB into RevPi
3. Mount and copy:
```bash
sudo mkdir -p /mnt/usb
sudo mount /dev/sda1 /mnt/usb
cp -r /mnt/usb/Boot-Monitoring /home/pi/
sudo umount /mnt/usb
```

### Step 2: Run Installation Script

```bash
cd /home/pi/Boot-Monitoring/deployment
sudo ./simple_install.sh
```

The installer will:
1. ✓ Update system packages
2. ✓ Install Python 3 and dependencies
3. ✓ Create virtual environment
4. ✓ Install Python packages
5. ✓ Generate secure configuration
6. ✓ Create systemd services
7. ✓ Set up light schedule automation
8. ✓ Configure firewall
9. ✓ Start the application
10. ✓ Display access information

### Step 3: Access the Application

After installation completes, access the application:

- **Network URL:** `http://<revpi-ip>:5000`
- **Default Login:**
  - Username: `bradken`
  - Password: `adminBradken25`

**⚠️ Important:** Change the default password after first login!

## What Gets Installed

### Main Application Service
- **Name:** `boot-monitoring.service`
- **Description:** Flask web application with Gunicorn WSGI server
- **Port:** 5000
- **Auto-start:** Yes (enabled on boot)

### Light Schedule Automation
- **Service:** `light-schedule-check.service`
- **Timer:** `light-schedule-check.timer`
- **Frequency:** Every 1 minute
- **Purpose:** Automatically enforces light ON/OFF schedule

### Files Created
```
/home/pi/Boot-Monitoring/
├── .env                          # Environment configuration (secure)
├── wsgi.py                       # Production WSGI entry point
├── gunicorn.conf.py              # Gunicorn configuration
├── venv/                         # Python virtual environment
├── users.db                      # SQLite database (auto-created)
└── system_info.json              # System information

/etc/systemd/system/
├── boot-monitoring.service       # Main app service
├── light-schedule-check.service  # Schedule checker service
└── light-schedule-check.timer    # Schedule checker timer

/var/log/
└── light-schedule-check.log      # Schedule automation logs
```

## Service Management

### Main Application

```bash
# Check status
systemctl status boot-monitoring

# View logs
journalctl -fu boot-monitoring

# Restart service
sudo systemctl restart boot-monitoring

# Stop service
sudo systemctl stop boot-monitoring

# Start service
sudo systemctl start boot-monitoring

# Disable auto-start
sudo systemctl disable boot-monitoring

# Enable auto-start
sudo systemctl enable boot-monitoring
```

### Light Schedule Automation

```bash
# Check timer status
systemctl status light-schedule-check.timer

# View schedule logs
tail -f /var/log/light-schedule-check.log

# List all timers
systemctl list-timers

# Stop timer
sudo systemctl stop light-schedule-check.timer

# Start timer
sudo systemctl start light-schedule-check.timer
```

## Configuration

### Environment Variables
Edit `/home/pi/Boot-Monitoring/.env`:

```bash
FLASK_ENV=production
SECRET_KEY=<auto-generated>
DEBUG=false
HOST=0.0.0.0
PORT=5000
APP_BRAND=BRADKEN
SESSION_TIMEOUT=3600
DEFAULT_USERNAME=bradken
DEFAULT_PASSWORD=adminBradken25
```

After editing, restart the service:
```bash
sudo systemctl restart boot-monitoring
```

### Change Port
To use a different port (e.g., 8080):

1. Edit `.env`:
```bash
PORT=8080
```

2. Edit `gunicorn.conf.py`:
```python
bind = "0.0.0.0:8080"
```

3. Update firewall:
```bash
sudo firewall-cmd --add-port=8080/tcp --permanent
sudo firewall-cmd --reload
```

4. Restart service:
```bash
sudo systemctl restart boot-monitoring
```

## Troubleshooting

### Service Won't Start

Check logs for errors:
```bash
journalctl -u boot-monitoring -n 100 --no-pager
```

Common issues:
- **Port already in use:** Check if another service uses port 5000
- **Permission errors:** Ensure files are owned by `pi` user
- **Missing dependencies:** Re-run installation script

### Can't Access from Network

1. Check if service is running:
```bash
systemctl status boot-monitoring
```

2. Check firewall:
```bash
# For firewalld
sudo firewall-cmd --list-all

# For ufw
sudo ufw status
```

3. Check if port is listening:
```bash
sudo netstat -tulpn | grep 5000
```

### Database Issues

If database is corrupted, recreate it:
```bash
sudo systemctl stop boot-monitoring
rm /home/pi/Boot-Monitoring/users.db
sudo systemctl start boot-monitoring
```

The database will be recreated with default admin user.

## Updating the Application

### From Git Repository

```bash
cd /home/pi/Boot-Monitoring
git pull
sudo systemctl restart boot-monitoring
```

### Manual Update

1. Copy new files to RevPi
2. Restart service:
```bash
sudo systemctl restart boot-monitoring
```

## Uninstallation

To completely remove the application:

```bash
# Stop and disable services
sudo systemctl stop boot-monitoring
sudo systemctl disable boot-monitoring
sudo systemctl stop light-schedule-check.timer
sudo systemctl disable light-schedule-check.timer

# Remove systemd files
sudo rm /etc/systemd/system/boot-monitoring.service
sudo rm /etc/systemd/system/light-schedule-check.service
sudo rm /etc/systemd/system/light-schedule-check.timer

# Reload systemd
sudo systemctl daemon-reload

# Remove application directory (optional)
rm -rf /home/pi/Boot-Monitoring

# Remove logs (optional)
sudo rm /var/log/light-schedule-check.log

# Remove firewall rule (optional)
sudo firewall-cmd --remove-port=5000/tcp --permanent
sudo firewall-cmd --reload
```

## Security Recommendations

1. **Change default password** immediately after installation
2. **Set unique SECRET_KEY** in production (auto-generated by installer)
3. **Enable firewall** and restrict access to port 5000
4. **Use HTTPS** if accessing over untrusted networks (requires reverse proxy)
5. **Regular backups** of `/home/pi/Boot-Monitoring/users.db`
6. **Keep system updated**: `sudo apt update && sudo apt upgrade`

## Network Configuration

The application requires network connectivity to:
- Monitor remote devices (Screen, Processor)
- Sync time via NTP
- Download updates (optional)

Configure device IP addresses in the web interface:
**Settings → Network Configuration**

## Support

For issues or questions:
- Check logs: `journalctl -u boot-monitoring -n 100`
- Review service status: `systemctl status boot-monitoring`
- Check application logs in the web interface: **Logs** page

## Advanced: Manual Installation

If you prefer manual installation instead of using the script:

1. Install dependencies
2. Create virtual environment
3. Install Python packages
4. Configure environment
5. Create systemd service
6. Enable and start service

See the `simple_install.sh` script for detailed commands.
